<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>Docker: часть 1 – введение, запуск удаление и проброс портов</title>


    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="offcanvas.css" rel="stylesheet">
</head>

<body>



<div class="container">

    <div class="row row-offcanvas row-offcanvas-right">

        <div class="col-12 col-md-9">
            <p class="float-right d-md-none">
                <button type="button" class="btn btn-primary btn-sm" data-toggle="offcanvas">Toggle nav</button>
            </p>
            <div class="jumbotron">
                <h1>DOCKER[1] - основы докера : часть 1 – введение, установка и запуск</h1>


                <p>Docker – система виртуализации, позволяющая запускать изолированные среды исполнения в рамках одной операционной системы.

                    Для реализации – используется система <strong>LXC (Linux Containers)</strong>, аналог jails во FreeBSD.</p>


                <p>Контейнеры и образы Docker
                    Система, которая запускается Docker-ом, называется “контейнером“, а команда запуска состоит из трёх частей:</p>
            <br />
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                <img src="/static/images/container_explainer.png">
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
            <br/><br/><br/>
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                <strong>Контейнер</strong> – это собственно сама “операционная система”, запущенная Docker-ом.
                <strong>Образ (image)</strong> – файл, представляющий собой эту операционную систему со всем необходимым набором ПО.


                При выполнении команды  docker run hello-world – выполняются следующие действия:<br/><br/>

                <ul>
                    <li>проверяется, если ли образ hello-world в локальном хранилище;</li>
                    <li>если он не найден – то выполняется поиск и загрузка указанного образа с Docker Hub, который является общедоступным хранилищем образов;</li>
                    <li>образ загружается на машину с Docker и запускается.</li>
                </ul>

                Пример. - запустим контейнер с Debian Wheezy.<br/><br/>

                С помощью опций -i (interactive) и -t (pseudo-TTY) – откроем на него консоль, а с помощью --rm – укажем на необходимость удалить контейнер после завершения работы с ним:

                <span>docker run -it --rm debian:wheezy</span><br/><br/>
            <br />

                <button type="button" class="btn btn-primary">Команды</button>
                <br />
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;


                <p>Для проверки уже имеющихся образов – на хост-машине выполните:</p>

                <p><span class="alert alert-success" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"> docker images</span></p>
                <div class="collapse" id="collapseExample">
                    <div class="card card-body">
                        # docker images<br/>
                          REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE<br/>
                          debian              wheezy              19de96c112fc        2 weeks ago         84.92 MB<br/>
                    </div>
                </div>







                <p>Проверить запущенные контейнеры можно так:</p>

                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerps" aria-expanded="false" aria-controls="dockerps"> docker ps</span></p>
                <div class="collapse" id="dockerps">
                    <div class="card card-body">
                        # docker ps<br/>
                        CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES<br/>
                        c3e506110ca3        debian:wheezy       "/bin/bash"         About a minute ago   Up About a minute                       lonely_meitner<br/>
                    </div>
                </div>

                &nbsp;
                &nbsp;
                <p>Проверить все контейнеры, в том числе отключенные:</p>
                &nbsp;
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerpsa" aria-expanded="false" aria-controls="dockerps"> docker ps -a
</span></p>
                <div class="collapse" id="dockerpsa">
                    <div class="card card-body">
                        # docker ps -a<br/>
                        CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES<br/>
                        c3e506110ca3        debian:wheezy       "/bin/bash"         About a minute ago   Up About a minute                       lonely_meitner                       lonely_meitner<br/>
                    </div>
                </div>
                &nbsp;
                &nbsp;
                <p>Удалить локальную копию образа можно так:</p>
                &nbsp;
                &nbsp;

                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerrmi" aria-expanded="false" aria-controls="dockerps"> docker rmi 19d
</span></p>
                <div class="collapse" id="dockerrmi">
                    <div class="card card-body">
                        # docker rmi 19d<br />
                        Untagged: debian:wheezy<br/>
                        Deleted: 19de96c112fcca5b6de16611dc0a359b0b977c551921ca79ac5cf4a8bfff9351<br/>
                        Deleted: ba249489d0b6512128b60a4910e78fa2000c785d59e0599188a6802bd01155f2                      lonely_meitner <br/>
                    </div>
                </div>


                <p>Где 19d – первые три цифры ID образа, полученные при помощи docker images.

                    Можно использовать как полный ID – так и только первые три символа.</p>

                &nbsp;
                &nbsp;
                <p>Удалить все образы и контейнеры:</p>
                &nbsp;
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerdell" aria-expanded="false" aria-controls="dockerps"> docker rm $(docker ps -a -q)</span></p>
                &nbsp;
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerdell" aria-expanded="false" aria-controls="dockerps"> docker rmi $(docker images -q)</span></p>
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                <div class="collapse" id="dockerdell">
                    <div class="card card-body">
                        #!/bin/bash<br />
                        # Delete all containers<br />
                        docker rm $(docker ps -a -q)<br />
                        # Delete all images<br />
                        docker rmi $(docker images -q)<br />
                    </div>
                </div>


                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;

                <h2>Сеть и Docker</h2>

                <p>По умолчанию – Docker запускает контейнеры в аналоге <a href="https://ru.wikipedia.org/wiki/NAT">NAT</a> – контейтеры “видят” интернет, но к ним самим подключиться нельзя.</p>

                <p>Однако при запуске контейнера – ему можно указать переадресацию портов.<br />Например</p>

                &nbsp;
                &nbsp;
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat" aria-expanded="false" aria-controls="dockerps"># docker run -p 127.0.0.1:2222:22 -ti debian:wheezy</span></p>
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernatps" aria-expanded="false" aria-controls="dockerps"># # docker ps</span></p>
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernatnetstat" aria-expanded="false" aria-controls="dockerps">#  netstat -anp | grep 2222</span></p>
                &nbsp;
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernattelnet" aria-expanded="false" aria-controls="dockerps">#  telnet localhost 2222</span></p>

                <div class="collapse" id="dockernat">
                    <div class="card card-body">
                        WARNING: Your kernel does not support memory swappiness capabilities, memory swappiness discarded.<br />
                        root@091cafd860bc:/#<br />
                    </div>
                </div>


                <div class="collapse" id="dockernatps">
                    <div class="card card-body">
                        # docker ps<br />
                        CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES<br />
                        00d472641904        debian:wheezy       "/bin/bash"         3 seconds ago       Up 2 seconds        127.0.0.1:2222->22/tcp   jolly_poincare<br />
                    </div>
                </div>


                <div class="collapse" id="dockernatnetstat">
                    <div class="card card-body">
                        # netstat -anp | grep 2222<br />
                        tcp        0      0 127.0.0.1:2222          0.0.0.0:*               LISTEN      8031/docker-proxy<br />
                    </div>
                </div>


                <div class="collapse" id="dockernattelnet">
                    <div class="card card-body">
                        # telnet localhost 2222<br />
                        Trying ::1...<br />
                        Trying 127.0.0.1...<br />
                        Connected to localhost.<br />
                        Escape character is '^]'.<br />
                        Connection closed by foreign host.<br />
                    </div>
                </div>




                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;

                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernatall" aria-expanded="false" aria-controls="dockerps">В контейнере – устанавливаем необъходимые пакеты и добавляем ключ:</span></p>


                <div class="collapse" id="dockernatall">
                    <div class="card card-body">
                        # apt-get update<br />
                        # apt-get install vim<br />
                        # apt-get install openssh-server<br />
                        # service ssh start<br />
                        [ ok ] Starting OpenBSD Secure Shell server: sshd.<br />
                        # cd /root/<br />
                        # mkdir .ssh && chmod 700 .ssh<br />
                        # vim .ssh/authorized_keys<br />
                        # cat .ssh/authorized_keys<br />
                        ssh-rsa AAAAB3NzaC1yc2EAAAA***kS304IZ root@debian<br />
                    </div>
                </div>

                &nbsp;

                <p>И пробуем подключиться с хоста:</p>

                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernatalls" aria-expanded="false" aria-controls="dockerps">ssh -i /root/.ssh/root_docker_1 root@localhost -p 2222
</span></p>

                <div class="collapse" id="dockernatalls">
                    <div class="card card-body">
                        # ssh -i /root/.ssh/root_docker_1 root@localhost -p 2222<br />
                        The authenticity of host '[localhost]:2222 ([127.0.0.1]:2222)' can't be established.<br />
                        ECDSA key fingerprint is 7e:e9:d5:f0:a3:38:91:45:18:6a:ec:29:a3:b1:46:62.<br />
                        Are you sure you want to continue connecting (yes/no)? yes<br />
                        Warning: Permanently added '[localhost]:2222' (ECDSA) to the list of known hosts.<br />
                        Linux nameless 4.0.9-gentoo #2 SMP Mon Jul 27 14:48:24 PDT 2015 x86_64<br />

                        The programs included with the Debian GNU/Linux system are free software;<br />
                        the exact distribution terms for each program are described in the<br />
                        individual files in /usr/share/doc/*/copyright.<br />

                        Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br />
                        permitted by applicable law.<br />
                        root@b252450a4d4e:~#<br />
                    </div>
                </div>

            </div>













            <div class="row">
                <div class="col-6 col-lg-4">
                    <h2>Task d[1][dth][1]</h2>
                    <p>
                    <ul>
                        <li>Load "example" image</li>
                        <li>Run "example" image</li>
                        <li>Delete "example" image</li>
                        <li>Forward the ports for the container</li>
                    </ul>
                    </p>

                    <p><a class="btn btn-secondary" href="/theme_l1_subtheme_task1" role="button">Show result &raquo;</a></p>
                    <p><button type="button" class="btn btn-info">Show code</button></p>
                </div><!--/span-->
            </div><!--/row-->
        </div><!--/span-->

        <div class="col-6 col-md-3 sidebar-offcanvas" id="sidebar">

            <div class="dropdown">
                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    Other themes
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="#">Docker</a></li>
                    <li><a href="#">Drupal 8</a></li>
                    <li><a href="#">Ansible</a></li>
                    <li role="separator" class="divider">Vagrant</li>
                    <li><a href="#">DEV Ops</a></li>
                </ul>
            </div>



            <div class="list-group">





                <a href="do[1]-domain-dom[1].html" class="list-group-item active">Основы Docker</a>
                <a href="#" class="list-group-item">Процесс сборки образов</a>
                <a href="#" class="list-group-item">Контейнеризация приложений</a>
                <a href="#" class="list-group-item">Основы сети в Docker</a>


            </div>
        </div><!--/span-->

        <div class="jumbotron">
            <h1>Documents and related links</h1>
            <a href="https://habrahabr.ru/post/310460/">Полное практическое руководство по Docker: с нуля до кластера на AWS</a>
        </div>

    </div><!--/row-->





    <hr>

    <footer>

    </footer>

</div><!--/.container-->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="../../../../assets/js/vendor/jquery.min.js"><\/script>')</script>
<script src="/static/js/popper.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="/static/js/ie10-viewport-bug-workaround.js"></script>
<script src="offcanvas.js"></script>
</body>
</html>