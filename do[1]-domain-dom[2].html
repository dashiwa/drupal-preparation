<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>Docker: часть 1 – введение, запуск удаление и проброс портов</title>


    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="offcanvas.css" rel="stylesheet">
</head>

<body>



<div class="container">

    <div class="row row-offcanvas row-offcanvas-right">

        <div class="col-12 col-md-9">
            <p class="float-right d-md-none">
                <button type="button" class="btn btn-primary btn-sm" data-toggle="offcanvas">Toggle nav</button>
            </p>
            <div class="jumbotron">
                <h1>Docker: часть 2 – управление контейнерами</h1>

                <br />
                <br />
                <br />
                <h2>Запуск контейнеров</h2>
                <br />
                <br />
                <br />
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                <p>Как говорилось в первой части – Docker использует LXC для запуска и управления контейнерами.

                Это значит, что в рамках одной хост-системы вы можете запустить любую ОС, которая будет совместима с ядром хоста.

                    Например, имеется Docker, работающий на Debian 7</p>







                <p><span class="alert alert-success" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"> # lsb_release -a
</span></p>
                <div class="collapse" id="collapseExample">
                    <div class="card card-body">
                        No LSB modules are available.<br/>
                        Distributor ID: Debian<br/>
                        Description:    Debian GNU/Linux 7.9 (wheezy)<br/>
                        Release:        7.9<br/>
                        Codename:       wheezy         84.92 MB
                    </div>
                </div>







                <p>С ядром:</p>

                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerps" aria-expanded="false" aria-controls="dockerps">  uname -r</span></p>
                <div class="collapse" id="dockerps">
                    <div class="card card-body">
                        # uname -r<br/>
                        3.16.0-0.bpo.4-amd64<br/>
                    </div>
                </div>

                &nbsp;
                &nbsp;
                <p>Попробуем запустить CentOS 7.

                    Находим образ:</p>
                &nbsp;
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerpsa" aria-expanded="false" aria-controls="dockerps"> docker search centos

</span></p>
                <div class="collapse" id="dockerpsa">
                    <div class="card card-body">
                        # docker search centos<br/>
                        NAME                                        DESCRIPTION <br/>                                    STARS     OFFICIAL   AUTOMATED
                        centos                                      The official build of CentOS.<br/>                   1399      [OK]
                        ...<br/>
                    </div>
                </div>
                &nbsp;
                &nbsp;
                <p>Вместо того, что бы сразу запустить контейнер с новым образом, как было показано в первой части – образ сначала можно загрузить в локальное хранилище с помощью опции pull:</p>
                &nbsp;
                &nbsp;

                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerrmi" aria-expanded="false" aria-controls="dockerps"> docker pull centos

</span></p>
                <div class="collapse" id="dockerrmi">
                    <div class="card card-body">
                        # docker pull centos<br />
                        Using default tag: latest<br />
                        latest: Pulling from library/centos<br />
                        47d44cb6f252: Pull complete<br />
                        f6f39725d938: Pull complete<br />
                        f9a8cbc8dd13: Pull complete<br />
                        f37e6a610a37: Pull complete<br />
                        0f73ae75014f: Pull complete<br />
                        Digest: sha256:2d9573acf37315cb8fe2a1420769c3b83f59d8f286fd8898a580578c0d5e66c6<br />
                        Status: Downloaded newer image for centos:latest                      lonely_meitner <br/>
                    </div>
                </div>


                <p>Теперь – его можно запускать локально:</p>

                &nbsp;
                &nbsp;

                &nbsp;
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockerdell" aria-expanded="false" aria-controls="dockerps"> docker run -ti --rm centos</span></p>
                        &nbsp;
                              &nbsp;
                &nbsp;
                &nbsp;
                <div class="collapse" id="dockerdell">
                    <div class="card card-body">
                        # docker run -ti --rm centos<br />
                        [root@cd8cc357e1c3 /]# cat /etc/redhat-release<br />
                        CentOS Linux release 7.1.1503 (Core)<br />
                    </div>
                </div>


                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;



                <p>Обратите внимание на ID в строке приглашения комндой строки контейнера: root@cd8cc357e1c3. Если на хост-машине выполнить:</p>



                &nbsp;
                &nbsp;
                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat" aria-expanded="false" aria-controls="dockerps"># docker ps | grep centos</span></p>
                &nbsp;

                <div class="collapse" id="dockernat">
                    <div class="card card-body">
                        # docker ps | grep centos<br />
                        cd8cc357e1c3        centos              "/bin/bash"         4 minutes ago       Up 4 minutes                                 ecstatic_jones<br />
                    </div>
                </div>


                <p>То вы увидите, что ID контейнера == ID в консоли.</p>



                <h2>Сохранение изменений в контейнерах</h2>
                <br />
                <p>Установим в этом CentOS-контейнере vim:</p>
                <br />
                <br />



                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockervim" aria-expanded="false" aria-controls="dockerps"> yum install vim</span></p>


                <div class="collapse" id="dockervim">
                    <div class="card card-body">
                        # vim --version<br />
                        VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Jun 10 2014 06:55:55)<br />
                    </div>
                </div>

                <br />

                <p>Если мы выйдем и выключим контейнер – то при следующем запуске из этого образа VIM в нём уже не будет.</p>

                <p>Что бы сохранить состояние контейнера – выполняем:</p>


                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;
                &nbsp;

                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernatall" aria-expanded="false" aria-controls="dockerps">docker commit cd8cc357e1c3 centos_with_vim</span></p>


                <div class="collapse" id="dockernatall">
                    <div class="card card-body">
                        # docker commit cd8cc357e1c3 centos_with_vim<br />
                        656188e54ccedc2fa26e353ced56a8ccb5be41fbc59e7f959c1407f99458023f<br />
                    </div>
                </div>

                &nbsp;

                <p>Где cd8cc357e1c3 – ID контейнера, а centos_with_vim – имя, под которым мы хотим его потом использовать:</p>

                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernatalls" aria-expanded="false" aria-controls="dockerps">docker images | grep centos</span></p>

                <div class="collapse" id="dockernatalls">
                    <div class="card card-body">
                        # docker images | grep centos<br />
                        centos_with_vim     latest              656188e54cce        52 seconds ago      298.2 MB<br />
                        centos              latest              0f73ae75014f        3 weeks ago         172.3 MB<br />
                    </div>
                </div>


                <p>Запускаем его:</p>


                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat1" aria-expanded="false" aria-controls="dockerps">docker run -ti --rm centos_with_vim
</span></p>

                <div class="collapse" id="dockernat1">
                    <div class="card card-body">
                        # docker run -ti --rm centos_with_vim<br />
                        ...
                        [root@cbe40ad5ccdd /]# vim --version<br />
                        VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Jun 10 2014 06:55:55)<br />
                    </div>
                </div>


                <p>Другой вариант запустить контейнер и выполнить в нём команду – указать её после имени образа, который будет запущен:</p>


                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat2" aria-expanded="false" aria-controls="dockerps">docker run -ti --rm centos_with_vim vim --version</span></p>

                <div class="collapse" id="dockernat2">
                    <div class="card card-body">
                        # docker run -ti --rm centos_with_vim vim --version<br/>
                        VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Jun 10 2014 06:55:55)<br/>
                    </div>
                </div>


                &nbsp;&nbsp;&nbsp;&nbsp;
                <p>Docker save и export – сохранение контейнера или образа</p>

                <p>Кратко о разнице между save и export:</p>

                <p>save – создаёт копию гостевой операционной системы, аналог ISO-образа;</p>
                <p>export – создаёт копию контейнера.</p>

                <h2>Пример Docker save</h2>

                <p>Находим необходимый нам образ:</p>


                &nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat3" aria-expanded="false" aria-controls="dockerps"># docker images | grep vim</span></p>

                <div class="collapse" id="dockernat3">
                    <div class="card card-body">                        # docker images | grep vim<br/>
                        centos_with_vim     latest              656188e54cce        37 minutes ago      298.2 MB<br/>
                    </div>
                </div>

                <p>Создаём его копию:</p>

                <strong>docker save centos_with_vim > /home/setevoy/centos_with_vim.tar</strong>


                &nbsp;&nbsp;&nbsp;<br /><br /><br />
                <p>Проверяем имеющиеся образы:</p>


                &nbsp;&nbsp;&nbsp;


                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat4" aria-expanded="false" aria-controls="dockerps"># docker images
</span></p>

                <div class="collapse" id="dockernat4">
                    <div class="card card-body"># docker images<br />
                        REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE<br/>
                    </div>
                </div>

                <p>А теперь добавляем образ из созданной копии с помощью load:</p>

                <br />
                <strong># docker load < /home/setevoy/centos_with_vim.tar</strong>
                &nbsp;&nbsp;&nbsp;
                <br />
                <br />
                <p>Проверяем:</p>
                &nbsp;&nbsp;&nbsp;


                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat5" aria-expanded="false" aria-controls="dockerps"># docker images
</span></p>

                <div class="collapse" id="dockernat5">
                    <div class="card card-body"># docker images<br />
                        REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE<br />
                        centos_with_vim     latest              656188e54cce        57 minutes ago      298.2 MB<br />
                    </div>
                </div>


                <p>Запускаем</p>

                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat6" aria-expanded="false" aria-controls="dockerps"># docker run -ti --rm centos_with_vim vim --version
</span></p>

                <div class="collapse" id="dockernat6">
                    <div class="card card-body"># docker images<br />
                        # docker run -ti --rm centos_with_vim vim --version<br />
                        VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Jun 10 2014 06:55:55)
                        ...<br />
                    </div>
                </div>




                <h2>Пример Docker export</h2>

                <p>На первом Docker-хосте находим ID нужного контейнера:</p>



                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat7" aria-expanded="false" aria-controls="dockerps"># docker ps</span></p>

                <div class="collapse" id="dockernat7">
                    <div class="card card-body"># docker images<br />
                        # docker ps
                        CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES<br />
                        cd8cc357e1c3        centos              "/bin/bash"         About an hour ago   Up About an hour                             ecstatic_jones<br />
                    </div>
                </div>



                <p>Експортируем его:</p>
                <strong># docker export cd8cc357e1c3 > /home/setevoy/centos_with_vim_export</strong>


                <p>Проверяем:</p>


                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat8" aria-expanded="false" aria-controls="dockerps"># tar tf /home/setevoy/centos_with_vim_export.tar  | head</span></p>

                <div class="collapse" id="dockernat8">
                    <div class="card card-body"># # tar tf /home/setevoy/centos_with_vim_export.tar  | head<br />
                        .dockerenv<br />
                        .dockerinit<br />
                        bin<br />
                        dev/<br />
                        dev/console<br />
                        dev/pts/<br />
                        dev/shm/<br />
                        etc/<br />
                        etc/.pwd.lock<br />
                        etc/BUILDTIME<br />
                        ...<br />
                       _
                    </div>
                </div>


                <br /><br /><br />
                &nbsp;&nbsp;&nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat9" aria-expanded="false" aria-controls="dockerps">ls -lh /home/setevoy/ | grep cent
</span></p>

                <div class="collapse" id="dockernat9">
                    <div class="card card-body"> # ls -lh /home/setevoy/ | grep cent<br />
                        -rw-r--r-- 1 root root 280M Sep 29 05:14 centos_with_vim_export.tar<br />
                        -rw-r--r-- 1 root root 295M Sep 29 04:52 centos_with_vim.tar<br />
                        _
                    </div>
                </div>


                <p>Копируем его на тот же удалённый хост со вторым Docker, и пробуем там запустить:</p>


                <br /><br /><br />
                &nbsp;&nbsp;&nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat10" aria-expanded="false" aria-controls="dockerps">cat /home/setevoy/centos_with_vim_export.tar | docker import - centos_with_vim_export:exported
</span></p>

                <div class="collapse" id="dockernat10">
                    <div class="card card-body"> cat /home/setevoy/centos_with_vim_export.tar | docker import - centos_with_vim_export:exported
                        12b806f347a44cdf864f2518010ca5b1ef05a2894f04a5ddfe1545949c4df7d0<br />
                        _
                    </div>
                </div>


                <br /><br /><br />
                &nbsp;&nbsp;&nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat11" aria-expanded="false" aria-controls="dockerps">docker images

</span></p>

                <div class="collapse" id="dockernat11">
                    <div class="card card-body"> # docker images
                        REPOSITORY               TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
                        centos_with_vim_export   exported            12b806f347a4        8 seconds ago       282 MB
                        centos_with_vim          latest              656188e54cce        About an hour ago   298.2 MB
                        _
                    </div>
                </div>


                <p>Пробуем его запустить:</p>

                <br /><br /><br />
                &nbsp;&nbsp;&nbsp;
                <p><span class="alert alert-success" data-toggle="collapse" data-target="#dockernat12" aria-expanded="false" aria-controls="dockerps">docker run --rm centos_with_vim_export:exported vim --version


</span></p>

                <div class="collapse" id="dockernat12">
                    <div class="card card-body"> # docker run --rm centos_with_vim_export:exported vim --version<br/>
                        VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Jun 10 2014 06:55:55)<br/>
                        _
                    </div>
                </div>





            </div>





            <div class="row">
                <div class="col-6 col-lg-4">
                    <h2>Task d[1][dth][1]</h2>
                    <p>
                    <ul>
                        <li>Use "example" image</li>
                        <li>Load new package for image</li>
                        <li>Save new changes</li>
                        <li>Run container and run load package command</li>
                        <li>Run container and run load package command</li>
                        <li>Create docker save example</li>
                        <li>Create docker export example</li>
                    </ul>
                    </p>

                    <p><a class="btn btn-secondary" href="/theme_l1_subtheme_task1" role="button">Show result &raquo;</a></p>
                    <p><button type="button" class="btn btn-info">Show code</button></p>
                </div><!--/span-->
            </div><!--/row-->
        </div><!--/span-->

        <div class="col-6 col-md-3 sidebar-offcanvas" id="sidebar">

            <div class="dropdown">
                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    Other themes
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="#">Docker</a></li>
                    <li><a href="#">Drupal 8</a></li>
                    <li><a href="#">Ansible</a></li>
                    <li role="separator" class="divider">Vagrant</li>
                    <li><a href="#">DEV Ops</a></li>
                </ul>
            </div>



            <div class="list-group">





                <a href="do[1]-domain-dom[1].html" class="list-group-item active">Основы Docker</a>
                <a href="#" class="list-group-item">Процесс сборки образов</a>
                <a href="#" class="list-group-item">Контейнеризация приложений</a>
                <a href="#" class="list-group-item">Основы сети в Docker</a>


            </div>
        </div><!--/span-->

        <div class="jumbotron">
            <h1>Documents and related links</h1>
            <a href="http://tuhrig.de/difference-between-save-and-export-in-docker//">http://tuhrig.de/difference-between-save-and-export-in-docker/</a>
        </div>

    </div><!--/row-->





    <hr>

    <footer>

    </footer>

</div><!--/.container-->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="../../../../assets/js/vendor/jquery.min.js"><\/script>')</script>
<script src="/static/js/popper.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="/static/js/ie10-viewport-bug-workaround.js"></script>
<script src="offcanvas.js"></script>
</body>
</html>